!function(r){"use strict";var u;redux.field_objects=redux.field_objects||{},redux.field_objects.media=redux.field_objects.media||{},r(document).ready(function(){}),redux.field_objects.media.init=function(e){e=e||r(document).find(".redux-group-tab:visible").find(".redux-container-media:visible"),r(e).each(function(){var e=r(this),i=e;(i=e.hasClass("redux-field-container")?i:e.parents(".redux-field-container:first")).is(":hidden")||i.hasClass("redux-field-init")&&(i.removeClass("redux-field-init"),u=!1,e.find(".remove-image, .remove-file").unbind("click").on("click",function(){redux.field_objects.media.removeFile(r(this).parents("fieldset.redux-field:first"))}),e.find(".media_upload_button").unbind().on("click",function(e){redux.field_objects.media.addFile(e,r(this).parents("fieldset.redux-field:first"))}))})},redux.field_objects.media.addFile=function(e,o){e.preventDefault();var s,d,i,e=r(this);s||(void 0!==(i=r(o).find(".library-filter").data("lib-filter"))&&""!==i&&(d=[],u=!0,i=decodeURIComponent(i),i=JSON.parse(i),r.each(i,function(e,i){d.push(i)})),(s=wp.media({multiple:!1,library:{type:d},title:e.data("choose"),button:{text:e.data("update")}})).on("select",function(){var e=s.state().get("selection").first(),i=(s.close(),r(o).find(".data").data());if(void 0===redux.field_objects.media?redux.field_objects.media={}:redux.field_objects.media,void 0!==i&&"undefined"!==i.mode||(i={mode:"image"}),!0===u&&(i.mode=0),0===i.mode||!1===i.mode||e.attributes.type===i.mode||e.attributes.subtype===i.mode){o.find(".upload").val(e.attributes.url),o.find(".upload-id").val(e.attributes.id),o.find(".upload-height").val(e.attributes.height),o.find(".upload-width").val(e.attributes.width),redux_change(r(o).find(".upload-id"));var d=e.attributes.url;if(void 0!==e.attributes.sizes&&void 0!==e.attributes.sizes.thumbnail)d=e.attributes.sizes.thumbnail.url;else if(void 0!==e.attributes.sizes){var t,a=e.attributes.height;for(t in e.attributes.sizes){var n=e.attributes.sizes[t];n.height<a&&(a=n.height,d=n.url)}}else d=e.attributes.icon;o.find(".upload-thumbnail").val(d),o.find(".upload").hasClass("noPreview")||o.find(".screenshot").empty().hide().append('<img class="redux-option-image" src="'+d+'">').slideDown("fast"),o.find(".remove-image").removeClass("hide"),o.find(".redux-background-properties").slideDown()}})),s.open()},redux.field_objects.media.removeFile=function(e){e.find(".remove-image").addClass("hide")&&(e.find(".remove-image").addClass("hide"),e.find(".upload").val(""),e.find(".upload-id").val(""),e.find(".upload-height").val(""),e.find(".upload-width").val(""),e.find(".upload-thumbnail").val(""),redux_change(r(e).find(".upload-id")),e.find(".redux-background-properties").hide(),e.find(".screenshot").slideUp(),e.find(".remove-file").unbind(),0<e.find(".section-upload .upload-notice").length&&e.find(".media_upload_button").remove())}}(jQuery);