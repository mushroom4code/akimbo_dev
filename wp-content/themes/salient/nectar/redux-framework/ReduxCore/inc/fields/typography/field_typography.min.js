!function(w){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.typography=redux.field_objects.typography||{};var _=[],j=!1,C={width:"resolve",triggerChange:!0,allowClear:!0};redux.field_objects.typography.init=function(e,t){e=e||w(document).find(".redux-group-tab:visible").find(".redux-container-typography:visible"),w(e).each(function(){var a,e=w(this),t=e;(t=e.hasClass("redux-field-container")?t:e.parents(".redux-field-container:first")).is(":hidden")||t.hasClass("redux-field-init")&&(t.removeClass("redux-field-init"),e.each(function(){w(this).find(".redux-typography-container").each(function(){var e=w(this).find(".redux-typography-family"),t=(void 0===e.data("value")?e=w(this):""!==e.data("value")&&w(e).val(e.data("value")),w(this).find(".select2_params"));0<t.size()&&(t=t.val(),t=JSON.parse(t),C=w.extend({},C,t)),a=Boolean(w(this).find(".redux-font-clear").val()),redux.field_objects.typography.select(e,!0),window.onbeforeunload=null}),w(this).find(".redux-typography").on("change",function(){redux.field_objects.typography.select(w(this))}),w(this).find(".redux-typography-size, .redux-typography-height, .redux-typography-word, .redux-typography-letter, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").keyup(function(){redux.field_objects.typography.select(w(this).parents(".redux-container-typography:first"))}),w(this).find(".redux-typography-color").wpColorPicker({change:function(e,t){w(this).val(t.color.toString()),redux.field_objects.typography.select(w(this))}}),w(this).find(".redux-typography-size").numeric({allowMinus:!1}),w(this).find(".redux-typography-height, .redux-typography-word, .redux-typography-letter").numeric({allowMinus:!0});var l=[{id:"none",text:"none"}];w(this).find(".redux-typography-family").select2({matcher:function(e,t){return 0===t.toUpperCase().indexOf(e.toUpperCase())},query:function(e){return window.Select2.query.local(l)(e)},initSelection:function(e,t){t({id:e.val(),text:e.val()})},allowClear:a}).on("select2-opening",function(e){var t=w(this).parents(".redux-container-typography:first").attr("data-id"),a=w("#"+t+" .redux-typography-font-family").data("user-fonts")?1:0,r=w("#"+t+" .redux-typography-google").val()?1:0,o=[];if(void 0!==redux.customfonts&&o.push(redux.customfonts),void 0!==redux.stdfonts&&0==a&&o.push(redux.stdfonts),1==a){var p,s=[];for(p in redux.typography[t]){var y,i=redux.typography[t].std_font;for(y in i)i.hasOwnProperty(y)&&s.push({id:y,text:y,"data-google":"false"})}o.push({text:"Standard Fonts",children:s})}(1==r||!0===r&&void 0!==redux.googlefonts)&&o.push(redux.googlefonts),l=o;a=(a=w("#"+t+" #"+t+"-family").attr("placeholder"))||null;w("#"+t+" .redux-typography-family").select2("val",a)}).on("select2-selecting",function(e,t){var a=e.object.text,r=w(this).parents(".redux-container-typography:first").attr("data-id");w("#"+r+" #"+r+"-family").data("value",a),w("#"+r+" #"+r+"-family").attr("placeholder",a),_=e,j=!0,redux.field_objects.typography.select(w(this).parents(".redux-container-typography:first"))}).on("select2-clearing",function(e,t){var a=w(this).parents(".redux-container-typography:first").attr("data-id");w("#"+a+" #"+a+"-family").attr("data-value",""),w("#"+a+" #"+a+"-family").attr("placeholder","Font Family"),w("#"+a+" #"+a+"-google-font").val("false"),redux.field_objects.typography.select(w(this).parents(".redux-container-typography:first"))}),e.find(".redux-typography-family").hasClass("redux-typography-family")||e.find(".redux-typography-style").select2(C),e.find(".redux-typography-family-backup, .redux-typography-align, .redux-typography-transform, .redux-typography-font-variant, .redux-typography-decoration").select2(C)}))})},redux.field_objects.typography.size=function(e){var t,a=0;for(t in e)e.hasOwnProperty(t)&&a++;return a},redux.field_objects.typography.makeBool=function(e){return"false"!=e&&"0"!=e&&!1!==e&&0!==e&&("true"==e||"1"==e||!0===e||1==e||void 0)},redux.field_objects.typography.contrastColour=function(e){var t="#444444";return""!==e&&(e=e.replace("#",""),t=128<=(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3?"#444444":"#ffffff"),t},redux.field_objects.typography.select=function(e,t){var a,r,o,p=w(e).parents(".redux-container-typography:first").attr("data-id"),s=(void 0===p&&(p=w(e).attr("data-id")),w(e).parents(".redux-container-typography:first"),(s=w("#"+p+" #"+p+"-family").val())||null),y=w("#"+p+" select.redux-typography-family-backup").val(),i=w("#"+p+" .redux-typography-size").val(),l=w("#"+p+" .redux-typography-height").val(),n=w("#"+p+" .redux-typography-word").val(),d=w("#"+p+" .redux-typography-letter").val(),h=w("#"+p+" select.redux-typography-align").val(),u=w("#"+p+" select.redux-typography-transform").val(),g=w("#"+p+" select.redux-typography-font-variant").val(),c=w("#"+p+" select.redux-typography-decoration").val(),f=w("#"+p+" select.redux-typography-style").val(),x=w("#"+p+" select.redux-typography-subsets").val(),v=w("#"+p+" .redux-typography-color").val(),b=w("#"+p).data("units"),m=(!0===j?(o=redux.field_objects.typography.makeBool(_.object["data-google"]),w("#"+p+" .redux-typography-google-font").val(o)):o=redux.field_objects.typography.makeBool(w("#"+p+" .redux-typography-google-font").val()),w("#"+p).hasClass("typography-initialized")||(f=w("#"+p+" select.redux-typography-style").data("value"),x=w("#"+p+" select.redux-typography-subsets").data("value"),""!==f&&(f=String(f)),x=String(x)),void 0===redux.fonts.google&&(o=!1),""),m=!0===o&&s in redux.fonts.google?redux.fonts.google[s]:{400:"Normal 400",700:"Bold 700","400italic":"Normal 400 Italic","700italic":"Bold 700 Italic"};w(e).hasClass("redux-typography-subsets")&&w("#"+p+" input.typography-subsets").val(x),w(e).hasClass("redux-typography-family")?(a='<option value=""></option>',!0===o?(r="",w.each(m.variants,function(e,t){t.id===f||1===redux.field_objects.typography.size(m.variants)?(r=' selected="selected"',f=t.id):r="",a+='<option value="'+t.id+'"'+r+">"+t.name.replace(/\+/g," ")+"</option>"}),w("#"+p+" .redux-typography-style").select2("destroy"),w("#"+p+" .redux-typography-style").html(a),w("#"+p+" .redux-typography-style").select2(C),r="",a='<option value=""></option>',w.each(m.subsets,function(e,t){t.id===x||1===redux.field_objects.typography.size(m.subsets)?(r=' selected="selected"',x=t.id,w("#"+p+" input.typography-subsets").val(x)):r="",a+='<option value="'+t.id+'"'+r+">"+t.name.replace(/\+/g," ")+"</option>"}),w("#"+p+" .redux-typography-subsets").select2("destroy"),w("#"+p+" .redux-typography-subsets").html(a),w("#"+p+" .redux-typography-subsets").select2(C),w("#"+p+" .redux-typography-subsets").parent().fadeIn("fast"),w("#"+p+" .typography-family-backup").fadeIn("fast")):m&&(w.each(m,function(e,t){e===f||"normal"===e?(r=' selected="selected"',w("#"+p+" .typography-style .select2-chosen").text(t)):r="",a+='<option value="'+e+'"'+r+">"+t.replace("+"," ")+"</option>"}),w("#"+p+" .redux-typography-style").select2("destroy"),w("#"+p+" .redux-typography-style").html(a),w("#"+p+" .redux-typography-style").select2(C),w("#"+p+" .redux-typography-subsets").parent().fadeOut("fast"),w("#"+p+" .typography-family-backup").fadeOut("fast")),w("#"+p+" .redux-typography-font-family").val(s)):w(e).hasClass("redux-typography-family-backup")&&""!==y&&w("#"+p+" .redux-typography-font-family-backup").val(y),0===w("#"+p+" select.redux-typography-style option[value='"+f+"']").length?(f="",w("#"+p+" select.redux-typography-style").select2("val","")):"400"===f&&w("#"+p+" select.redux-typography-style").select2("val",f),0===w("#"+p+" select.redux-typography-subsets option[value='"+x+"']").length&&(x="",w("#"+p+" select.redux-typography-subsets").select2("val",""),w("#"+p+" input.typography-subsets").val(x)),w("."+("style_link_"+p)).remove(),null!==s&&"inherit"!==s&&w("#"+p).hasClass("typography-initialized")&&(y=s.replace(/\s+/g,"+"),!0===o?(o=y,f&&""!==f&&(o+=":"+f.replace(/\-/g," ")),x&&""!==x&&(o+="&subset="+x),!1===j&&"undefined"!=typeof WebFont&&WebFont&&WebFont.load({google:{families:[o]}}),w("#"+p+" .redux-typography-google").val(!0)):w("#"+p+" .redux-typography-google").val(!1)),-1!==f.indexOf("italic")?(w("#"+p+" .typography-preview").css("font-style","italic"),w("#"+p+" .typography-font-style").val("italic"),f=f.replace("italic","")):(w("#"+p+" .typography-preview").css("font-style","normal"),w("#"+p+" .typography-font-style").val("")),w("#"+p+" .typography-font-weight").val(f),""===i||void 0===i?w("#"+p+" .typography-font-size").val(""):w("#"+p+" .typography-font-size").val(i+b),""===l||void 0===l?w("#"+p+" .typography-line-height").val(""):w("#"+p+" .typography-line-height").val(l+b),""===n||void 0===n?w("#"+p+" .typography-word-spacing").val(""):w("#"+p+" .typography-word-spacing").val(n+b),""===d||void 0===d?w("#"+p+" .typography-letter-spacing").val(""):w("#"+p+" .typography-letter-spacing").val(d+b),w("#"+p).hasClass("typography-initialized")&&("0"==w("#"+p+" .typography-preview").data("preview-size")&&w("#"+p+" .typography-preview").css("font-size",i+b),w("#"+p+" .typography-preview").css("font-weight",f),w("#"+p+" .typography-preview").css("font-family",s+", sans-serif"),"none"===s&&""===s&&w("#"+p+" .typography-preview").css("font-family","inherit"),w("#"+p+" .typography-preview").css("line-height",l+b),w("#"+p+" .typography-preview").css("word-spacing",n+b),w("#"+p+" .typography-preview").css("letter-spacing",d+b),v&&(w("#"+p+" .typography-preview").css("color",v),w("#"+p+" .typography-preview").css("background-color",redux.field_objects.typography.contrastColour(v))),w("#"+p+" .typography-style .select2-chosen").text(w("#"+p+" .redux-typography-style option:selected").text()),w("#"+p+" .typography-script .select2-chosen").text(w("#"+p+" .redux-typography-subsets option:selected").text()),h&&w("#"+p+" .typography-preview").css("text-align",h),u&&w("#"+p+" .typography-preview").css("text-transform",u),g&&w("#"+p+" .typography-preview").css("font-variant",g),c&&w("#"+p+" .typography-preview").css("text-decoration",c),w("#"+p+" .typography-preview").slideDown()),w("#"+p).hasClass("typography-initialized")||w("#"+p).addClass("typography-initialized"),j=!1,t||redux_change(e)}}(jQuery);